{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{IonBackButton,IonButton,IonButtons,IonContent,IonDatetime,IonHeader,IonInput,IonItem,IonLabel,IonList,IonPage,IonTextarea,IonTitle,IonToolbar}from'@ionic/react';import React,{useState,useEffect,useRef}from'react';import{useHistory}from'react-router';import{useAuth}from'../auth';import{firestore,storage}from'../firebase';function savePicture(_x,_x2){return _savePicture.apply(this,arguments);}function _savePicture(){_savePicture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(blobUrl,userId){var pictureRef,response,blob,snapshot,url;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:pictureRef=storage.ref(\"/users/\".concat(userId,\"/pictures/\").concat(Date.now()));_context2.next=3;return fetch(blobUrl);case 3:response=_context2.sent;_context2.next=6;return response.blob();case 6:blob=_context2.sent;_context2.next=9;return pictureRef.put(blob);case 9:snapshot=_context2.sent;_context2.next=12;return snapshot.ref.getDownloadURL();case 12:url=_context2.sent;console.log('saved picture:',url);return _context2.abrupt(\"return\",url);case 15:case\"end\":return _context2.stop();}}},_callee2);}));return _savePicture.apply(this,arguments);}var AddEntryPage=function AddEntryPage(){var _useAuth=useAuth(),userId=_useAuth.userId;var history=useHistory();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),date=_useState2[0],setDate=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),title=_useState4[0],setTitle=_useState4[1];var _useState5=useState('/assets/placeholder.png'),_useState6=_slicedToArray(_useState5,2),pictureUrl=_useState6[0],setPictureUrl=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),description=_useState8[0],setDescription=_useState8[1];var fileInputRef=useRef();useEffect(function(){return function(){if(pictureUrl.startsWith('blob:')){URL.revokeObjectURL(pictureUrl);}};},[pictureUrl]);var handleFileChange=function handleFileChange(event){if(event.target.files.length>0){var file=event.target.files.item(0);var _pictureUrl=URL.createObjectURL(file);setPictureUrl(_pictureUrl);}};var handleSave=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var entriesRef,entryData,entryRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:entriesRef=firestore.collection('users').doc(userId).collection('entries');entryData={date:date,title:title,pictureUrl:pictureUrl,description:description};if(!pictureUrl.startsWith('blob:')){_context.next=6;break;}_context.next=5;return savePicture(pictureUrl,userId);case 5:entryData.pictureUrl=_context.sent;case 6:_context.next=8;return entriesRef.add(entryData);case 8:entryRef=_context.sent;console.log('saved:',entryRef.id);history.goBack();case 11:case\"end\":return _context.stop();}}},_callee);}));return function handleSave(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(IonPage,null,/*#__PURE__*/React.createElement(IonHeader,null,/*#__PURE__*/React.createElement(IonToolbar,null,/*#__PURE__*/React.createElement(IonButtons,{slot:\"start\"},/*#__PURE__*/React.createElement(IonBackButton,null)),/*#__PURE__*/React.createElement(IonTitle,null,\"Add Entry\"))),/*#__PURE__*/React.createElement(IonContent,{className:\"ion-padding\"},/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Date\"),/*#__PURE__*/React.createElement(IonDatetime,{value:date,onIonChange:function onIonChange(event){return setDate(event.detail.value);}})),/*#__PURE__*/React.createElement(IonList,null,/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Title\"),/*#__PURE__*/React.createElement(IonInput,{value:title,onIonChange:function onIonChange(event){return setTitle(event.detail.value);}})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Picture\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",accept:\"image/*\",hidden:true,ref:fileInputRef,onChange:handleFileChange}),/*#__PURE__*/React.createElement(\"img\",{src:pictureUrl,alt:\"\",style:{cursor:'pointer'},onClick:function onClick(){return fileInputRef.current.click();}})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Description\"),/*#__PURE__*/React.createElement(IonTextarea,{value:description,onIonChange:function onIonChange(event){return setDescription(event.detail.value);}}))),/*#__PURE__*/React.createElement(IonButton,{expand:\"block\",onClick:handleSave},\"Save\")));};export default AddEntryPage;","map":{"version":3,"sources":["/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/src/pages/AddEntryPage.tsx"],"names":["IonBackButton","IonButton","IonButtons","IonContent","IonDatetime","IonHeader","IonInput","IonItem","IonLabel","IonList","IonPage","IonTextarea","IonTitle","IonToolbar","React","useState","useEffect","useRef","useHistory","useAuth","firestore","storage","savePicture","blobUrl","userId","pictureRef","ref","Date","now","fetch","response","blob","put","snapshot","getDownloadURL","url","console","log","AddEntryPage","history","date","setDate","title","setTitle","pictureUrl","setPictureUrl","description","setDescription","fileInputRef","startsWith","URL","revokeObjectURL","handleFileChange","event","target","files","length","file","item","createObjectURL","handleSave","entriesRef","collection","doc","entryData","add","entryRef","id","goBack","detail","value","cursor","current","click"],"mappings":"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","sourcesContent":["import {\n  IonBackButton,\n  IonButton,\n  IonButtons,\n  IonContent,\n  IonDatetime,\n  IonHeader,\n  IonInput,\n  IonItem,\n  IonLabel,\n  IonList,\n  IonPage,\n  IonTextarea,\n  IonTitle,\n  IonToolbar,\n} from '@ionic/react';\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useHistory } from 'react-router';\nimport { useAuth } from '../auth';\nimport { firestore, storage } from '../firebase';\n\nasync function savePicture(blobUrl, userId) {\n  const pictureRef = storage.ref(`/users/${userId}/pictures/${Date.now()}`);\n  const response = await fetch(blobUrl);\n  const blob = await response.blob();\n  const snapshot = await pictureRef.put(blob);\n  const url = await snapshot.ref.getDownloadURL();\n  console.log('saved picture:', url);\n  return url;\n}\n\nconst AddEntryPage: React.FC = () => {\n  const { userId } = useAuth();\n  const history = useHistory();\n  const [date, setDate] = useState('');\n  const [title, setTitle] = useState('');\n  const [pictureUrl, setPictureUrl] = useState('/assets/placeholder.png');\n  const [description, setDescription] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>();\n  useEffect(() => () => {\n    if (pictureUrl.startsWith('blob:')) {\n      URL.revokeObjectURL(pictureUrl);\n    }\n  }, [pictureUrl]);\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files.length > 0) {\n      const file = event.target.files.item(0);\n      const pictureUrl = URL.createObjectURL(file);\n      setPictureUrl(pictureUrl);\n    }\n  };\n\n  const handleSave = async () => {\n    const entriesRef = firestore.collection('users').doc(userId)\n      .collection('entries');\n    const entryData = { date, title, pictureUrl, description };\n    if (pictureUrl.startsWith('blob:')) {\n      entryData.pictureUrl = await savePicture(pictureUrl, userId);\n    }\n    const entryRef = await entriesRef.add(entryData);\n    console.log('saved:', entryRef.id);\n    history.goBack();\n  };\n\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonButtons slot=\"start\">\n            <IonBackButton />\n          </IonButtons>\n          <IonTitle>Add Entry</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent className=\"ion-padding\">\n        <IonItem>\n          <IonLabel position=\"stacked\">Date</IonLabel>\n          <IonDatetime value={date}\n            onIonChange={(event) => setDate(event.detail.value)}\n          />\n        </IonItem>\n        <IonList>\n          <IonItem>\n            <IonLabel position=\"stacked\">Title</IonLabel>\n            <IonInput value={title}\n              onIonChange={(event) => setTitle(event.detail.value)}\n            />\n          </IonItem>\n          <IonItem>\n            <IonLabel position=\"stacked\">Picture</IonLabel><br />\n            <input type=\"file\" accept=\"image/*\" hidden ref={fileInputRef}\n              onChange={handleFileChange}\n            />\n            <img src={pictureUrl} alt=\"\" style={{ cursor: 'pointer' }}\n              onClick={() => fileInputRef.current.click()}\n            />\n          </IonItem>\n          <IonItem>\n            <IonLabel position=\"stacked\">Description</IonLabel>\n            <IonTextarea value={description}\n              onIonChange={(event) => setDescription(event.detail.value)}\n            />\n          </IonItem>\n        </IonList>\n        <IonButton expand=\"block\" onClick={handleSave}>Save</IonButton>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default AddEntryPage;\n"]},"metadata":{},"sourceType":"module"}