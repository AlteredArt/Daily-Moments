{"ast":null,"code":"var _jsxFileName = \"/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/src/pages/AddEntryPage.tsx\";\nimport { IonBackButton, IonButton, IonButtons, IonContent, IonDatetime, IonHeader, IonInput, IonItem, IonLabel, IonList, IonPage, IonTextarea, IonTitle, IonToolbar } from '@ionic/react';\nimport { Plugins } from '@capacitor/core';\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useHistory } from 'react-router';\nimport { useAuth } from '../auth';\nimport { firestore, storage } from '../firebase';\nconst {\n  Camera\n} = Plugins;\n\nasync function savePicture(blobUrl, userId) {\n  const pictureRef = storage.ref(`/users/${userId}/pictures/${Date.now()}`);\n  const response = await fetch(blobUrl);\n  const blob = await response.blob();\n  const snapshot = await pictureRef.put(blob);\n  const url = await snapshot.ref.getDownloadURL();\n  console.log('saved picture:', url);\n  return url;\n}\n\nconst AddEntryPage = () => {\n  const {\n    userId\n  } = useAuth();\n  const history = useHistory();\n  const [date, setDate] = useState('');\n  const [title, setTitle] = useState('');\n  const [pictureUrl, setPictureUrl] = useState('/assets/placeholder.png');\n  const [description, setDescription] = useState('');\n  const fileInputRef = useRef();\n  useEffect(() => () => {\n    if (pictureUrl.startsWith('blob:')) {\n      URL.revokeObjectURL(pictureUrl);\n    }\n  }, [pictureUrl]);\n\n  const handleFileChange = event => {\n    if (event.target.files.length > 0) {\n      const file = event.target.files.item(0);\n      const pictureUrl = URL.createObjectURL(file);\n      setPictureUrl(pictureUrl);\n    }\n  };\n\n  const handlePictureClick = async () => {\n    // fileInputRef.current.click();\n    const photo = await Camera.getPhoto({\n      resultType: CameraResultType.Uri\n    });\n    console.log('photo:', photo.webPath);\n  };\n\n  const handleSave = async () => {\n    const entriesRef = firestore.collection('users').doc(userId).collection('entries');\n    const entryData = {\n      date,\n      title,\n      pictureUrl,\n      description\n    };\n\n    if (pictureUrl.startsWith('blob:')) {\n      entryData.pictureUrl = await savePicture(pictureUrl, userId);\n    }\n\n    const entryRef = await entriesRef.add(entryData);\n    console.log('saved:', entryRef.id);\n    history.goBack();\n  };\n\n  return /*#__PURE__*/React.createElement(IonPage, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(IonHeader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(IonToolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(IonButtons, {\n    slot: \"start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(IonBackButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(IonTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 11\n    }\n  }, \"Add Entry\"))), /*#__PURE__*/React.createElement(IonContent, {\n    className: \"ion-padding\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(IonItem, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(IonLabel, {\n    position: \"stacked\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 11\n    }\n  }, \"Date\"), /*#__PURE__*/React.createElement(IonDatetime, {\n    value: date,\n    onIonChange: event => setDate(event.detail.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(IonList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(IonItem, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(IonLabel, {\n    position: \"stacked\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, \"Title\"), /*#__PURE__*/React.createElement(IonInput, {\n    value: title,\n    onIonChange: event => setTitle(event.detail.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(IonItem, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(IonLabel, {\n    position: \"stacked\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  }, \"Picture\"), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 60\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    hidden: true,\n    ref: fileInputRef,\n    onChange: handleFileChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"img\", {\n    src: pictureUrl,\n    alt: \"\",\n    style: {\n      cursor: 'pointer'\n    },\n    onClick: handlePictureClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(IonItem, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(IonLabel, {\n    position: \"stacked\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }\n  }, \"Description\"), /*#__PURE__*/React.createElement(IonTextarea, {\n    value: description,\n    onIonChange: event => setDescription(event.detail.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(IonButton, {\n    expand: \"block\",\n    onClick: handleSave,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, \"Save\")));\n};\n\nexport default AddEntryPage;","map":{"version":3,"sources":["/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/src/pages/AddEntryPage.tsx"],"names":["IonBackButton","IonButton","IonButtons","IonContent","IonDatetime","IonHeader","IonInput","IonItem","IonLabel","IonList","IonPage","IonTextarea","IonTitle","IonToolbar","Plugins","React","useState","useEffect","useRef","useHistory","useAuth","firestore","storage","Camera","savePicture","blobUrl","userId","pictureRef","ref","Date","now","response","fetch","blob","snapshot","put","url","getDownloadURL","console","log","AddEntryPage","history","date","setDate","title","setTitle","pictureUrl","setPictureUrl","description","setDescription","fileInputRef","startsWith","URL","revokeObjectURL","handleFileChange","event","target","files","length","file","item","createObjectURL","handlePictureClick","photo","getPhoto","resultType","CameraResultType","Uri","webPath","handleSave","entriesRef","collection","doc","entryData","entryRef","add","id","goBack","detail","value","cursor"],"mappings":"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","sourcesContent":["import {\n  IonBackButton,\n  IonButton,\n  IonButtons,\n  IonContent,\n  IonDatetime,\n  IonHeader,\n  IonInput,\n  IonItem,\n  IonLabel,\n  IonList,\n  IonPage,\n  IonTextarea,\n  IonTitle,\n  IonToolbar,\n} from '@ionic/react';\nimport {Plugins} from '@capacitor/core'\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useHistory } from 'react-router';\nimport { useAuth } from '../auth';\nimport { firestore, storage } from '../firebase';\nconst {Camera} = Plugins;\nasync function savePicture(blobUrl, userId) {\n  const pictureRef = storage.ref(`/users/${userId}/pictures/${Date.now()}`);\n  const response = await fetch(blobUrl);\n  const blob = await response.blob();\n  const snapshot = await pictureRef.put(blob);\n  const url = await snapshot.ref.getDownloadURL();\n  console.log('saved picture:', url);\n  return url;\n}\n\nconst AddEntryPage: React.FC = () => {\n  const { userId } = useAuth();\n  const history = useHistory();\n  const [date, setDate] = useState('');\n  const [title, setTitle] = useState('');\n  const [pictureUrl, setPictureUrl] = useState('/assets/placeholder.png');\n  const [description, setDescription] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>();\n  useEffect(() => () => {\n    if (pictureUrl.startsWith('blob:')) {\n      URL.revokeObjectURL(pictureUrl);\n    }\n  }, [pictureUrl]);\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files.length > 0) {\n      const file = event.target.files.item(0);\n      const pictureUrl = URL.createObjectURL(file);\n      setPictureUrl(pictureUrl);\n    }\n  };\n\n  const handlePictureClick = async () => {\n    // fileInputRef.current.click();\n    const photo = await Camera.getPhoto({\n      resultType: CameraResultType.Uri,\n    });\n    console.log('photo:', photo.webPath);\n  }\n\n  const handleSave = async () => {\n    const entriesRef = firestore.collection('users').doc(userId)\n      .collection('entries');\n    const entryData = { date, title, pictureUrl, description };\n    if (pictureUrl.startsWith('blob:')) {\n      entryData.pictureUrl = await savePicture(pictureUrl, userId);\n    }\n    const entryRef = await entriesRef.add(entryData);\n    console.log('saved:', entryRef.id);\n    history.goBack();\n  };\n\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonButtons slot=\"start\">\n            <IonBackButton />\n          </IonButtons>\n          <IonTitle>Add Entry</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent className=\"ion-padding\">\n        <IonItem>\n          <IonLabel position=\"stacked\">Date</IonLabel>\n          <IonDatetime value={date}\n            onIonChange={(event) => setDate(event.detail.value)}\n          />\n        </IonItem>\n        <IonList>\n          <IonItem>\n            <IonLabel position=\"stacked\">Title</IonLabel>\n            <IonInput value={title}\n              onIonChange={(event) => setTitle(event.detail.value)}\n            />\n          </IonItem>\n          <IonItem>\n            <IonLabel position=\"stacked\">Picture</IonLabel><br />\n            <input type=\"file\" accept=\"image/*\" hidden ref={fileInputRef}\n              onChange={handleFileChange}\n            />\n            <img src={pictureUrl} alt=\"\" style={{ cursor: 'pointer' }}\n              onClick={handlePictureClick}\n            />\n          </IonItem>\n          <IonItem>\n            <IonLabel position=\"stacked\">Description</IonLabel>\n            <IonTextarea value={description}\n              onIonChange={(event) => setDescription(event.detail.value)}\n            />\n          </IonItem>\n        </IonList>\n        <IonButton expand=\"block\" onClick={handleSave}>Save</IonButton>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default AddEntryPage;\n"]},"metadata":{},"sourceType":"module"}