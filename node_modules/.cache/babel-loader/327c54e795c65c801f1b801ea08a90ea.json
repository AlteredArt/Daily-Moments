{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{IonBackButton,IonButton,IonButtons,IonContent,IonDatetime,IonHeader,IonInput,IonItem,IonLabel,IonList,IonPage,IonTextarea,IonTitle,IonToolbar,isPlatform}from'@ionic/react';import{Plugins,CameraResultType,CameraSource}from'@capacitor/core';import React,{useState,useEffect,useRef}from'react';import{useHistory}from'react-router';import{useAuth}from'../auth';import{firestore,storage}from'../firebase';var Camera=Plugins.Camera;function savePicture(_x,_x2){return _savePicture.apply(this,arguments);}function _savePicture(){_savePicture=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(blobUrl,userId){var pictureRef,response,blob,snapshot,url;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:pictureRef=storage.ref(\"/users/\".concat(userId,\"/pictures/\").concat(Date.now()));_context3.next=3;return fetch(blobUrl);case 3:response=_context3.sent;_context3.next=6;return response.blob();case 6:blob=_context3.sent;_context3.next=9;return pictureRef.put(blob);case 9:snapshot=_context3.sent;_context3.next=12;return snapshot.ref.getDownloadURL();case 12:url=_context3.sent;console.log('saved picture:',url);return _context3.abrupt(\"return\",url);case 15:case\"end\":return _context3.stop();}}},_callee3);}));return _savePicture.apply(this,arguments);}var AddEntryPage=function AddEntryPage(){var _useAuth=useAuth(),userId=_useAuth.userId;var history=useHistory();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),date=_useState2[0],setDate=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),title=_useState4[0],setTitle=_useState4[1];var _useState5=useState('/assets/placeholder.png'),_useState6=_slicedToArray(_useState5,2),pictureUrl=_useState6[0],setPictureUrl=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),description=_useState8[0],setDescription=_useState8[1];var fileInputRef=useRef();useEffect(function(){return function(){if(pictureUrl.startsWith('blob:')){URL.revokeObjectURL(pictureUrl);}};},[pictureUrl]);var handleFileChange=function handleFileChange(event){if(event.target.files.length>0){var file=event.target.files.item(0);var _pictureUrl=URL.createObjectURL(file);setPictureUrl(_pictureUrl);}};var handlePictureClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var photo;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!isPlatform('capacitor')){_context.next=13;break;}_context.prev=1;_context.next=4;return Camera.getPhoto({resultType:CameraResultType.Uri,source:CameraSource.Prompt,width:600});case 4:photo=_context.sent;setPictureUrl(photo.webPath);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log('Camera error:',_context.t0);case 11:_context.next=14;break;case 13:fileInputRef.current.click();case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function handlePictureClick(){return _ref.apply(this,arguments);};}();var handleSave=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var entriesRef,entryData,entryRef;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:entriesRef=firestore.collection('users').doc(userId).collection('entries');entryData={date:date,title:title,pictureUrl:pictureUrl,description:description};if(!pictureUrl.startsWith('/assets')){_context2.next=6;break;}_context2.next=5;return savePicture(pictureUrl,userId);case 5:entryData.pictureUrl=_context2.sent;case 6:_context2.next=8;return entriesRef.add(entryData);case 8:entryRef=_context2.sent;console.log('saved:',entryRef.id);history.goBack();case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSave(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(IonPage,null,/*#__PURE__*/React.createElement(IonHeader,null,/*#__PURE__*/React.createElement(IonToolbar,null,/*#__PURE__*/React.createElement(IonButtons,{slot:\"start\"},/*#__PURE__*/React.createElement(IonBackButton,null)),/*#__PURE__*/React.createElement(IonTitle,null,\"Add Entry\"))),/*#__PURE__*/React.createElement(IonContent,{className:\"ion-padding\"},/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Date\"),/*#__PURE__*/React.createElement(IonDatetime,{value:date,onIonChange:function onIonChange(event){return setDate(event.detail.value);}})),/*#__PURE__*/React.createElement(IonList,null,/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Title\"),/*#__PURE__*/React.createElement(IonInput,{value:title,onIonChange:function onIonChange(event){return setTitle(event.detail.value);}})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Picture\"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",accept:\"image/*\",hidden:true,ref:fileInputRef,onChange:handleFileChange}),/*#__PURE__*/React.createElement(\"img\",{src:pictureUrl,alt:\"\",style:{cursor:'pointer'},onClick:handlePictureClick})),/*#__PURE__*/React.createElement(IonItem,null,/*#__PURE__*/React.createElement(IonLabel,{position:\"stacked\"},\"Description\"),/*#__PURE__*/React.createElement(IonTextarea,{value:description,onIonChange:function onIonChange(event){return setDescription(event.detail.value);}}))),/*#__PURE__*/React.createElement(IonButton,{expand:\"block\",onClick:handleSave},\"Save\")));};export default AddEntryPage;","map":{"version":3,"sources":["/Users/zeta/Documents/XXX/Languages/ionic/daily-moments/src/pages/AddEntryPage.tsx"],"names":["IonBackButton","IonButton","IonButtons","IonContent","IonDatetime","IonHeader","IonInput","IonItem","IonLabel","IonList","IonPage","IonTextarea","IonTitle","IonToolbar","isPlatform","Plugins","CameraResultType","CameraSource","React","useState","useEffect","useRef","useHistory","useAuth","firestore","storage","Camera","savePicture","blobUrl","userId","pictureRef","ref","Date","now","fetch","response","blob","put","snapshot","getDownloadURL","url","console","log","AddEntryPage","history","date","setDate","title","setTitle","pictureUrl","setPictureUrl","description","setDescription","fileInputRef","startsWith","URL","revokeObjectURL","handleFileChange","event","target","files","length","file","item","createObjectURL","handlePictureClick","getPhoto","resultType","Uri","source","Prompt","width","photo","webPath","current","click","handleSave","entriesRef","collection","doc","entryData","add","entryRef","id","goBack","detail","value","cursor"],"mappings":"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","sourcesContent":["import {\n  IonBackButton,\n  IonButton,\n  IonButtons,\n  IonContent,\n  IonDatetime,\n  IonHeader,\n  IonInput,\n  IonItem,\n  IonLabel,\n  IonList,\n  IonPage,\n  IonTextarea,\n  IonTitle,\n  IonToolbar,\n  isPlatform\n} from '@ionic/react';\nimport {Plugins, CameraResultType, CameraSource} from '@capacitor/core';\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useHistory } from 'react-router';\nimport { useAuth } from '../auth';\nimport { firestore, storage } from '../firebase';\n\nconst {Camera} = Plugins;\n\nasync function savePicture(blobUrl, userId) {\n  const pictureRef = storage.ref(`/users/${userId}/pictures/${Date.now()}`);\n  const response = await fetch(blobUrl);\n  const blob = await response.blob();\n  const snapshot = await pictureRef.put(blob);\n  const url = await snapshot.ref.getDownloadURL();\n  console.log('saved picture:', url);\n  return url;\n}\n\nconst AddEntryPage: React.FC = () => {\n  const { userId } = useAuth();\n  const history = useHistory();\n  const [date, setDate] = useState('');\n  const [title, setTitle] = useState('');\n  const [pictureUrl, setPictureUrl] = useState('/assets/placeholder.png');\n  const [description, setDescription] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>();\n  useEffect(() => () => {\n    if (pictureUrl.startsWith('blob:')) {\n      URL.revokeObjectURL(pictureUrl);\n    }\n  }, [pictureUrl]);\n\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    if (event.target.files.length > 0) {\n      const file = event.target.files.item(0);\n      const pictureUrl = URL.createObjectURL(file);\n      setPictureUrl(pictureUrl);\n    }\n  };\n\n  const handlePictureClick = async () => {\n    if (isPlatform('capacitor')){\n      try {const photo = await Camera.getPhoto({\n        resultType: CameraResultType.Uri,\n        source: CameraSource.Prompt,\n        width: 600,\n      });\n      setPictureUrl(photo.webPath);\n    } catch (error) {\n      console.log('Camera error:', error);\n    }\n  } else {\n    fileInputRef.current.click();\n  }\n};\n\n  const handleSave = async () => {\n    const entriesRef = firestore.collection('users').doc(userId)\n      .collection('entries');\n    const entryData = { date, title, pictureUrl, description };\n    if (pictureUrl.startsWith('/assets')) {\n      entryData.pictureUrl = await savePicture(pictureUrl, userId);\n    }\n    const entryRef = await entriesRef.add(entryData);\n    console.log('saved:', entryRef.id);\n    history.goBack();\n  };\n\n  return (\n    <IonPage>\n      <IonHeader>\n        <IonToolbar>\n          <IonButtons slot=\"start\">\n            <IonBackButton />\n          </IonButtons>\n          <IonTitle>Add Entry</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent className=\"ion-padding\">\n        <IonItem>\n          <IonLabel position=\"stacked\">Date</IonLabel>\n          <IonDatetime value={date}\n            onIonChange={(event) => setDate(event.detail.value)}\n          />\n        </IonItem>\n        <IonList>\n          <IonItem>\n            <IonLabel position=\"stacked\">Title</IonLabel>\n            <IonInput value={title}\n              onIonChange={(event) => setTitle(event.detail.value)}\n            />\n          </IonItem>\n          <IonItem>\n            <IonLabel position=\"stacked\">Picture</IonLabel><br />\n            <input type=\"file\" accept=\"image/*\" hidden ref={fileInputRef}\n              onChange={handleFileChange}\n            />\n            <img src={pictureUrl} alt=\"\" style={{ cursor: 'pointer' }}\n              onClick={handlePictureClick}\n            />\n          </IonItem>\n          <IonItem>\n            <IonLabel position=\"stacked\">Description</IonLabel>\n            <IonTextarea value={description}\n              onIonChange={(event) => setDescription(event.detail.value)}\n            />\n          </IonItem>\n        </IonList>\n        <IonButton expand=\"block\" onClick={handleSave}>Save</IonButton>\n      </IonContent>\n    </IonPage>\n  );\n};\n\nexport default AddEntryPage;\n"]},"metadata":{},"sourceType":"module"}